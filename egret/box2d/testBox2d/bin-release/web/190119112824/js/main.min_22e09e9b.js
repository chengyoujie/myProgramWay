var __reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},b2;!function(e){e.Color=Box2D.Common.b2Color,e.Settings=Box2D.Common.b2Settings,e.Mat22=Box2D.Common.Math.b2Mat22,e.Mat33=Box2D.Common.Math.b2Mat33,e.Math=Box2D.Common.Math.b2Math,e.Sweep=Box2D.Common.Math.b2Sweep,e.Transform=Box2D.Common.Math.b2Transform,e.Vec2=Box2D.Common.Math.b2Vec2,e.Vec3=Box2D.Common.Math.b2Vec3,e.AABB=Box2D.Collision.b2AABB,e.ContactID=Box2D.Collision.b2ContactID,e.ContactPoint=Box2D.Collision.b2ContactPoint,e.DistanceInput=Box2D.Collision.b2DistanceInput,e.DistanceOutput=Box2D.Collision.b2DistanceOutput,e.DistanceProxy=Box2D.Collision.b2DistanceProxy,e.DynamicTree=Box2D.Collision.b2DynamicTree,e.DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,e.DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,e.Manifold=Box2D.Collision.b2Manifold,e.ManifoldPoint=Box2D.Collision.b2ManifoldPoint,e.OBB=Box2D.Collision.b2OBB,e.RayCastInput=Box2D.Collision.b2RayCastInput,e.RayCastOutput=Box2D.Collision.b2RayCastOutput,e.Segment=Box2D.Collision.b2Segment,e.SimplexCache=Box2D.Collision.b2SimplexCache,e.TOIInput=Box2D.Collision.b2TOIInput,e.WorldManifold=Box2D.Collision.b2WorldManifold,e.atures=Box2D.Collision.Features,e.CircleShape=Box2D.Collision.Shapes.b2CircleShape,e.EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,e.EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,e.MassData=Box2D.Collision.Shapes.b2MassData,e.PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,e.Shape=Box2D.Collision.Shapes.b2Shape,e.Body=Box2D.Dynamics.b2Body,e.BodyDef=Box2D.Dynamics.b2BodyDef,e.ContactFilter=Box2D.Dynamics.b2ContactFilter,e.ContactImpulse=Box2D.Dynamics.b2ContactImpulse,e.ContactListener=Box2D.Dynamics.b2ContactListener,e.DebugDraw=Box2D.Dynamics.b2DebugDraw,e.DestructionListener=Box2D.Dynamics.b2DestructionListener,e.FilterData=Box2D.Dynamics.b2FilterData,e.Fixture=Box2D.Dynamics.b2Fixture,e.FixtureDef=Box2D.Dynamics.b2FixtureDef,e.World=Box2D.Dynamics.b2World,e.Contact=Box2D.Dynamics.Contacts.b2Contact,e.ContactEdge=Box2D.Dynamics.Contacts.b2ContactEdge,e.ContactResult=Box2D.Dynamics.Contacts.b2ContactResult,e.Controller=Box2D.Dynamics.Controllers.b2Controller,e.ControllerEdge=Box2D.Dynamics.Controllers.b2ControllerEdge,e.BuoyancyController=Box2D.Dynamics.Controllers.b2BuoyancyController,e.ConstantAccelController=Box2D.Dynamics.Controllers.b2ConstantAccelController,e.ConstantForceController=Box2D.Dynamics.Controllers.b2ConstantForceController,e.GravityController=Box2D.Dynamics.Controllers.b2GravityController,e.TensorDampingController=Box2D.Dynamics.Controllers.b2TensorDampingController,e.Joint=Box2D.Dynamics.Joints.b2Joint,e.JointDef=Box2D.Dynamics.Joints.b2JointDef,e.JointEdge=Box2D.Dynamics.Joints.b2JointEdge,e.DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,e.DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,e.FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,e.FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef,e.GearJoint=Box2D.Dynamics.Joints.b2GearJoint,e.GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef,e.LineJoint=Box2D.Dynamics.Joints.b2LineJoint,e.LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,e.MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,e.MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,e.PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,e.PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,e.PullyJoint=Box2D.Dynamics.Joints.b2PullyJoint,e.PullyJointDef=Box2D.Dynamics.Joints.b2PullyJointDef,e.RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,e.RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,e.WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,e.WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef}(b2||(b2={}));var Main=function(e){function t(){var t=e.call(this)||this;return console.log("test"),t.testBox2d(),t}return __extends(t,e),t.prototype.testBox2d=function(){var e=new TestCar;this.addChild(e),e.start()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Test=function(e){function t(){var t=e.call(this)||this;return t._dp=30,t}return __extends(t,e),t.prototype.start=function(){var e=new b2.World(new b2.Vec2(0,10),!0);this._world=e;var t=new egret.Sprite;this._sp=t,this.addChild(t);var o=new b2.DebugDraw;o.SetSprite(t),o.SetDrawScale(this._dp),o.SetAlpha(.5),o.SetFillAlpha(.8),o.SetLineThickness(2),o.SetFlags(b2.DebugDraw.e_shapeBit|b2.DebugDraw.e_jointBit),e.SetDebugDraw(o);var i=egret.sys.$TempStage,n=i.stageWidth,r=i.stageHeight,a=10,s=10;this.createBox(s,s,a,r,!0),this.createBox(s,r-a-s,n,a,!0),this.createBox(n-a-s,s,a,r,!0),this.createBox(s,s,n,a,!0);for(var l=0;6>l;l++)this.createBox(Math.random()*n,100*Math.random()+40,30*Math.random()+30,30*Math.random()+30);var c=this.createBox(100,100,40,40,!0),D=this.createBox(100,200,20,20),h=new b2.RevoluteJointDef;h.localAnchorA=c.GetWorldCenter(),h.localAnchorB=D.GetWorldCenter(),h.bodyA=c,h.bodyB=D;var d=this.createBox(200,150,30,30,!0),y=this.createBox(500,150,10,10),b=new b2.DistanceJointDef;b.localAnchorA=d.GetWorldCenter(),b.localAnchorB=y.GetWorldCenter(),b.bodyA=d,b.bodyB=y;for(var B=(e.CreateJoint(b),e.CreateJoint(h),e.GetBodyList());B;)console.log(B.GetType()),B=B.GetNext();egret.sys.$TempStage.addEventListener(egret.Event.ENTER_FRAME,this.tick,this),egret.sys.$TempStage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.handleClick,this),console.log("the box2d world created")},t.prototype.handleClick=function(e){this._clickVec=new b2.Vec2(e.stageX/this._dp,e.stageY/this._dp);var t=new b2.AABB;t.lowerBound=new b2.Vec2(e.stageX/this._dp-.1,e.stageY/this._dp-.1),t.upperBound=new b2.Vec2(e.stageX/this._dp+.1,e.stageY/this._dp+.1);var o=this;this._world.QueryAABB(function(e){return o.handleAABB(e)},t)},t.prototype.handleAABB=function(e){return e.GetBody().GetType()==b2.Body.b2_staticBody?!0:e.GetShape().TestPoint(e.GetBody().GetTransform(),this._clickVec)?(this._clickObj=e.GetBody(),this._clickObj.SetAwake(!0),!1):!0},t.prototype.createBox=function(e,t,o,i,n){void 0===n&&(n=!1);var r=new b2.BodyDef;r.position=new b2.Vec2(e/this._dp,t/this._dp),n?r.type=b2.Body.b2_staticBody:r.type=b2.Body.b2_dynamicBody;var a=this._world.CreateBody(r),s=new b2.PolygonShape;s.SetAsBox(o/this._dp,i/this._dp);var l=new b2.FixtureDef;return l.density=5,l.restitution=.3,l.shape=s,a.CreateFixture(l),a},t.prototype.tick=function(){this._world.Step(1/60,10,10),this._world.DrawDebugData()},t}(egret.DisplayObjectContainer);__reflect(Test.prototype,"Test");var TestCar=function(e){function t(){var t=e.call(this)||this;return t._scale=30,t}return __extends(t,e),t.prototype.start=function(){var e=new b2.Vec2(0,10);this._wrold=new b2.World(e,!0),this.initDebug();var t=new b2.PolygonShape;t.SetAsBox(600/this._scale,10/this._scale);var o=new b2.FixtureDef;o.density=0,o.restitution=.3,o.shape=t;var i=new b2.BodyDef;i.position.Set(100/this._scale,800/this._scale);var n=this._wrold.CreateBody(i);n.CreateFixture(o);new b2.PolygonShape;t.SetAsBox(10/this._scale,1200/this._scale);var r=new b2.FixtureDef;r.density=2,r.restitution=.3,r.shape=t;var a=new b2.BodyDef;a.angle=85*Math.PI/180,a.position.Set(1300/this._scale,750/this._scale);var s=this._wrold.CreateBody(a);s.CreateFixture(r);var l=new b2.PolygonShape;l.SetAsBox(10/this._scale,1200/this._scale);var c=new b2.FixtureDef;c.density=2,c.restitution=.3,c.shape=l;var D=new b2.BodyDef;D.angle=-85*Math.PI/180,D.position.Set(-700/this._scale,750/this._scale);var h=this._wrold.CreateBody(D);h.CreateFixture(c);var d=new b2.BodyDef;d.position.Set(300/this._scale,520/this._scale),d.type=b2.Body.b2_dynamicBody;var y=new eui.Image("res/car.png");this.addChild(y),y.anchorOffsetX=94,y.anchorOffsetY=46;var b=new eui.Image("res/whell.png");this.addChild(b),b.anchorOffsetX=32.5,b.anchorOffsetY=32.5;var B=new eui.Image("res/whell.png");this.addChild(B),B.anchorOffsetX=32.5,B.anchorOffsetY=32.5;var p=new b2.PolygonShape;p.SetAsBox(95/this._scale,40/this._scale);var C=new b2.FixtureDef;C.density=2,C.restitution=.3,C.filter.groupIndex=-1,C.shape=p;var x=this._wrold.CreateBody(d);x.CreateFixture(C),x.SetUserData(y),this._car=x;var u=new b2.PolygonShape;u.SetAsBox(15/this._scale,15/this._scale);var _=new b2.FixtureDef;_.density=2,_.restitution=.5,_.filter.groupIndex=-1,_.shape=u;var m=new b2.BodyDef;m.type=b2.Body.b2_dynamicBody,m.position.Set(x.GetWorldCenter().x+46/this._scale,x.GetWorldCenter().y+40/this._scale),m.userData=b;var f=this._wrold.CreateBody(m);f.CreateFixture(_);var w=new b2.FixtureDef;w.density=2,w.restitution=.5,w.filter.groupIndex=-1,w.shape=u;var S=new b2.BodyDef;S.position.Set(x.GetWorldCenter().x-60/this._scale,x.GetWorldCenter().y+40/this._scale),S.type=b2.Body.b2_dynamicBody,S.userData=B;var v=this._wrold.CreateBody(S);v.CreateFixture(w);var g=new b2.CircleShape(33/this._scale),J=new b2.FixtureDef;J.density=2.6,J.restitution=.5,J.friction=.3,J.shape=g,J.filter.groupIndex=-1;var M=new b2.BodyDef;M.position.Set(x.GetWorldCenter().x+46/this._scale,x.GetWorldCenter().y+40/this._scale),M.type=b2.Body.b2_dynamicBody;var F=this._wrold.CreateBody(M);F.CreateFixture(J);var G=new b2.BodyDef;G.position.Set(x.GetWorldCenter().x-60/this._scale,x.GetWorldCenter().y+40/this._scale),G.type=b2.Body.b2_dynamicBody;var T=this._wrold.CreateBody(G);T.CreateFixture(J);var A=new b2.RevoluteJointDef;A.Initialize(f,F,F.GetWorldCenter()),A.enableMotor=!0,A.maxMotorTorque=10;var P=new b2.RevoluteJointDef;P.Initialize(v,T,T.GetWorldCenter()),P.enableMotor=!0,P.maxMotorTorque=10,this.frontrevolute=this._wrold.CreateJoint(A),this.rearrevolute=this._wrold.CreateJoint(P);var W=new b2.PrismaticJointDef;W.enableLimit=!0,W.enableMotor=!0,W.upperTranslation=5/this._scale,W.lowerTranslation=-5/this._scale,W.Initialize(F,x,F.GetWorldCenter(),new b2.Vec2(0,1)),this.frontprismatic=this._wrold.CreateJoint(W),W.Initialize(T,x,T.GetWorldCenter(),new b2.Vec2(0,1)),this.rearprismatic=this._wrold.CreateJoint(W),egret.sys.$TempStage.addEventListener(egret.Event.ENTER_FRAME,this.handleEnterFrame,this)},t.prototype.initDebug=function(){var e=new b2.DebugDraw;e.SetSprite(this),e.SetFillAlpha(.5),e.SetDrawScale(this._scale),e.SetFlags(b2.DebugDraw.e_shapeBit|b2.DebugDraw.e_jointBit),this._wrold.SetDebugDraw(e)},t.prototype.handleEnterFrame=function(){this._wrold.Step(1/60,10,10),this._wrold.DrawDebugData();var e=this._car.GetUserData();e.y<770?(this.frontrevolute.SetMotorSpeed(0),this.rearrevolute.SetMotorSpeed(0),this.rearprismatic.SetMaxMotorForce(0),this.rearprismatic.SetMotorSpeed(0)):(this.frontrevolute.SetMotorSpeed(100),this.rearrevolute.SetMotorSpeed(100),this.rearprismatic.SetMaxMotorForce(50),this.rearprismatic.SetMotorSpeed(50));for(var t=this._wrold.GetBodyList();void 0!=t;t=t.GetNext()){var o=t.GetUserData();o&&(o.x=t.GetPosition().x*this._scale,o.y=t.GetPosition().y*this._scale,o.rotation=180*t.GetAngle()/Math.PI)}this.x=-this._car.GetPosition().x*this._scale+300,this._wrold.ClearForces()},t}(egret.Sprite);__reflect(TestCar.prototype,"TestCar");